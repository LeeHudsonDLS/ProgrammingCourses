#! Generated by VisualDCT v2.6
#! DBDSTART
#! DBDEND


record(mbbo, "$(user)-EA-SHTR-01:COMP1:CTRL") {
  field(DESC, "Output mode demand")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Auto")
}

record(mbbo, "$(user)-EA-SHTR-01:COMP2:CTRL") {
  field(DESC, "Output mode demand")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Auto")
}

record(mbbo, "$(user)-EA-SHTR-01:COMP3:CTRL") {
  field(DESC, "Output mode demand")
  field(ZRST, "Open")
  field(ONST, "Close")
  field(TWST, "Auto")
}


record(ai, "$(user)-EA-SHTR-01:REQ_LOCK_STATE") {
  field(SCAN, ".2 second")
  field(FLNK, "$(user)-EA-SHTR-01:LOCK_INVERT")
}


# Fast shutter interlock
# Lee Hudson	
#
# This database takes a value from a PMAC that dictates whether or not the Beamstop or 
# Scintillator is protecting the detector from direct beam. If there is no protection
# from direct beam the fast shutter is forced closed. If there is protection this database
# must not have any influence on the shutter, ie, it must not write to it.
#
# From PMAC:
#	P1306 = 0 	Detector is exposed, force shutter closed
#	P1306 = 1	Detector is protected, allow normal control of the shutter
#



record(calcout, "$(user)-EA-SHTR-01:LOCK_INVERT") {
  field(FLNK, "$(user)-EA-SHTR-01:LOCK_INVERT_DISPLAY")
  field(CALC, "(A>1)?1:!A")
  field(INPA, "$(user)-EA-SHTR-01:REQ_LOCK_STATE")
}

record(calcout, "$(user)-EA-SHTR-01:LOCK_INVERT_DISPLAY") {
  field(FLNK, "$(user)-EA-SHTR-01:LOCK")
  field(CALC, "!A")
  field(INPA, "$(user)-EA-SHTR-01:LOCK_INVERT")
}

record(calcout, "$(user)-EA-SHTR-01:LOCK") {
  field(CALC, "A")
  field(INPA, "$(user)-EA-SHTR-01:LOCK_INVERT")
  field(OUT, "$(user)-EA-SHTR-01:LOCK:FAN PP")
  field(OOPT, "When Non-zero")
  field(FLNK, "$(user)-EA-SHTR-01:LOCKED_CALC")
}

record(mbbo, "$(user)-EA-SHTR-01:OVERRIDE_SHUTTER_LOCK") {
  field(DTYP, "Soft Channel")
  field(OUT, "$(user)-EA-SHTR-01:LOCK.DISA")
  field(ZRVL, "0")
  field(ONVL, "1")
  field(ZRST, "Operational")
  field(ONST, "Overridden")
  field(FLNK, "$(user)-EA-SHTR-01:LOCKED_CALC")
}

record(calcout, "$(user)-EA-SHTR-01:LOCKED_CALC") {
  field(CALC, "(B>0)?0:A")
  field(INPA, "$(user)-EA-SHTR-01:LOCK PP")
  field(INPB, "$(user)-EA-SHTR-01:OVERRIDE_SHUTTER_LOCK.RVAL PP")
}

record(dfanout, "$(user)-EA-SHTR-01:LOCK:FAN") {
  field(OUTA, "$(user)-EA-SHTR-01:COMP1:CTRL.DISA PP")
  field(OUTB, "$(user)-EA-SHTR-01:COMP2:CTRL.DISA PP")
  field(OUTC, "$(user)-EA-SHTR-01:COMP3:CTRL.DISA PP")
}


